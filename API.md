# API æ¥å£æ–‡æ¡£ ğŸ“¡

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†å‰ç«¯ä¸åç«¯äº¤äº’çš„æ‰€æœ‰ API æ¥å£ã€‚

## åŸºç¡€ä¿¡æ¯

### Base URL

```
å¼€å‘ç¯å¢ƒ: http://localhost:8082
ç”Ÿäº§ç¯å¢ƒ: https://your-api-domain.com
```

### è¯·æ±‚å¤´

```http
Content-Type: application/json
X-Device-Fingerprint: <è®¾å¤‡æŒ‡çº¹ID>  # æŸäº›æ¥å£éœ€è¦
```

### å“åº”æ ¼å¼

æˆåŠŸå“åº”ï¼š
```json
{
  "success": true,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ"
}
```

é”™è¯¯å“åº”ï¼š
```json
{
  "success": false,
  "message": "é”™è¯¯ä¿¡æ¯",
  "code": "ERROR_CODE"
}
```

---

## æ¥å£åˆ—è¡¨

### 1. æ·»åŠ è¯¾ç¨‹è¯„ä»·

æäº¤æ–°çš„è¯¾ç¨‹è¯„ä»·ä¿¡æ¯ã€‚

**æ¥å£åœ°å€**: `/add_course`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| course_name | string | æ˜¯ | è¯¾ç¨‹åç§° |
| course_attribute | string | æ˜¯ | è¯¾ç¨‹å±æ€§ï¼ˆä½“è‚²è¯¾/å…¬é€‰è¯¾/å…¬å…±è¯¾/ä¸“ä¸šè¯¾ç¨‹/é€šè¯†å¿…ä¿®è¯¾ï¼‰ |
| elective_field | string | å¦ | å…¬é€‰è¯¾é¢†åŸŸï¼ˆä»…å…¬é€‰è¯¾éœ€è¦å¡«å†™ï¼‰ |
| instructor | string | æ˜¯ | æˆè¯¾æ•™å¸ˆå§“å |
| content | string | æ˜¯ | è¯¾ç¨‹å†…å®¹ä¸è¯„ä»· |
| attendance | string | æ˜¯ | è€ƒå‹¤ä¸å¹³æ—¶ä½œä¸šè¦æ±‚ |
| assessment | string | æ˜¯ | æœŸæœ«è€ƒæ ¸æ–¹å¼ |
| grade | number/string | å¦ | è¯¾ç¨‹æˆç»©ï¼ˆ0-100 æˆ– "Unknown"ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "course_name": "é«˜ç­‰æ•°å­¦",
  "course_attribute": "å…¬å…±è¯¾",
  "elective_field": "",
  "instructor": "å¼ æ•™æˆ",
  "content": "è¯¾ç¨‹å†…å®¹å……å®ï¼Œè®²è§£æ¸…æ™°",
  "attendance": "æ¯å‘¨ç‚¹åï¼Œä½œä¸šæ¯å‘¨ä¸€æ¬¡",
  "assessment": "æœŸæœ«è€ƒè¯•70%ï¼Œå¹³æ—¶æˆç»©30%",
  "grade": 85
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "è¯¾ç¨‹è¯„ä»·æ·»åŠ æˆåŠŸ"
}
```

---

### 2. æœç´¢è¯¾ç¨‹è¯„ä»·

æ ¹æ®è¯¾ç¨‹åç§°å’Œ/æˆ–æ•™å¸ˆå§“åæœç´¢è¯¾ç¨‹è¯„ä»·ã€‚

**æ¥å£åœ°å€**: `/search`

**è¯·æ±‚æ–¹æ³•**: `GET`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| course_name | string | å¦ | è¯¾ç¨‹åç§°ï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰ |
| instructor | string | å¦ | æ•™å¸ˆå§“åï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /search?course_name=é«˜ç­‰æ•°å­¦&instructor=å¼ 
```

**å“åº”ç¤ºä¾‹**:

```json
[
  {
    "è¯¾ç¨‹åç§°": "é«˜ç­‰æ•°å­¦",
    "è¯¾ç¨‹å±æ€§": "å…¬å…±è¯¾",
    "å…¬é€‰è¯¾é¢†åŸŸ": "",
    "æˆè¯¾è€å¸ˆ": "å¼ æ•™æˆ",
    "è¯¾ç¨‹å†…å®¹ä¸è¯„ä»·": "è¯¾ç¨‹å†…å®¹å……å®ï¼Œè®²è§£æ¸…æ™°",
    "è€ƒå‹¤ä¸å¹³æ—¶ä½œä¸š": "æ¯å‘¨ç‚¹åï¼Œä½œä¸šæ¯å‘¨ä¸€æ¬¡",
    "æœŸæœ«è€ƒæ ¸æ–¹å¼": "æœŸæœ«è€ƒè¯•70%ï¼Œå¹³æ—¶æˆç»©30%",
    "è¯¾ç¨‹æˆç»©": 85
  }
]
```

---

### 3. è·å–ç»Ÿè®¡æ•°æ®

è·å–è¯¾ç¨‹è¯„ä»·çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

**æ¥å£åœ°å€**: `/statistic`

**è¯·æ±‚æ–¹æ³•**: `GET`

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:

```json
{
  "visitCount": 123,
  "evaluationCount": 456
}
```

**å­—æ®µè¯´æ˜**:
- `visitCount`: æœ€è¿‘æ·»åŠ çš„è¯„ä»·æ•°é‡
- `evaluationCount`: è¯¾ç¨‹è¯„ä»·æ€»æ•°

---

### 4. AI è¾…åŠ©æ¨è

åŸºäº RAG æŠ€æœ¯çš„è¯¾ç¨‹æ™ºèƒ½æ¨èã€‚

**æ¥å£åœ°å€**: `/rag`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯·æ±‚å¤´**: éœ€è¦åŒ…å« `X-Device-Fingerprint`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| userQuestion | string | æ˜¯ | ç”¨æˆ·éœ€æ±‚æè¿°ï¼ˆ0-50å­—ï¼‰ |
| catagory | number | å¦ | è¯¾ç¨‹ç±»åˆ«ï¼ˆ0:ä»»æ„, 1:ä½“è‚²è¯¾, 2:å…¬é€‰è¯¾, 3:å…¬å…±è¯¾, 4:ä¸“ä¸šè¯¾, 5:å¯¼å¼•ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "userQuestion": "æˆ‘æƒ³æ‰¾ä¸€é—¨ç»™åˆ†å¥½ä¸”æœ‰è¶£çš„å…¬é€‰è¯¾",
  "catagory": 2
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "course": "å…¬å…±å…³ç³»å­¦",
        "reason": "å¤šä¸ªè¯„ä»·æ˜¾ç¤ºç»™åˆ†å¾ˆå¥½(95åˆ†), å¼€å·è€ƒè¯•ç®€å•, è€å¸ˆæœ‰è¶£ä¸”è€ƒå‹¤çµæ´»"
      },
      {
        "course": "æ²»æ°´ä¸ç¤¾ä¼šå‘å±•",
        "reason": "å¤šä¸ªè¯„ä»·ä¸€è‡´ç§°èµç»™åˆ†å¥½(90+), è€å¸ˆä¼˜ç§€, è®ºæ–‡ç»“è¯¾è¦æ±‚å®½æ¾"
      },
      {
        "course": "ç”µå½±è‰ºæœ¯ä¸å¤§ä¼—æ–‡åŒ–",
        "reason": "ç»™åˆ†å¥½(95åˆ†), ä¸Šè¯¾è½»æ¾æœ‰è¶£, å¯çœ‹ç”µå½±, è®ºæ–‡ç»“è¯¾æ–¹å¼çµæ´»"
      }
    ],
    "llm_output": "LLM åŸå§‹è¾“å‡ºæ–‡æœ¬",
    "llm_response_text": "LLM å“åº”æ–‡æœ¬ï¼ˆMarkdown æ ¼å¼ï¼‰",
    "rag_results": []
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- éœ€è¦è®¾å¤‡æŒ‡çº¹éªŒè¯
- è¶…æ—¶æ—¶é—´è¾ƒé•¿ï¼ˆ120ç§’ï¼‰
- æ¯å‘¨é™åˆ¶ä½¿ç”¨æ¬¡æ•°

---

### 5. æäº¤æ–°ç”Ÿé—®å·

æ–°ç”Ÿå®Œæˆé—®å·è°ƒæŸ¥ã€‚

**æ¥å£åœ°å€**: `/submit_survey`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| curricula | boolean | æ˜¯ | æ˜¯å¦äº†è§£é€‰è¯¾ä½“ç³» |
| accept | string | æ˜¯ | æ›´çœ‹é‡ä»€ä¹ˆï¼ˆ"æ•™å­¦"/"ç»™åˆ†"ï¼‰ |
| expectation | number | æ˜¯ | å¯¹è¯¾ç¨‹çš„æœŸå¾…ï¼ˆ1-10åˆ†ï¼‰ |
| suggestions | string | å¦ | å¯¹å­¦ç”Ÿç¤¾åŒºçš„å»ºè®® |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "curricula": true,
  "accept": "æ•™å­¦",
  "expectation": 8.5,
  "suggestions": "å¸Œæœ›èƒ½æœ‰æ›´å¤šçš„è¯¾ç¨‹èµ„æºåˆ†äº«"
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "é—®å·æäº¤æˆåŠŸ"
}
```

---

### 6. æäº¤è¯¾ç¨‹æ¨å¹¿

æ•™å¸ˆæäº¤è¯¾ç¨‹æ¨å¹¿ä¿¡æ¯ã€‚

**æ¥å£åœ°å€**: `/course_promotion`

**è¯·æ±‚æ–¹æ³•**: `POST`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| course_name | string | æ˜¯ | è¯¾ç¨‹åç§° |
| course_attribute | string | æ˜¯ | è¯¾ç¨‹å±æ€§ |
| elective_field | string | å¦ | å…¬é€‰è¯¾é¢†åŸŸ |
| instructor | string | æ˜¯ | æˆè¯¾æ•™å¸ˆ |
| credit | number | æ˜¯ | å­¦åˆ† |
| content | string | æ˜¯ | è¯¾ç¨‹å†…å®¹ä»‹ç» |
| attendance | string | æ˜¯ | è€ƒå‹¤ä¸ä½œä¸šè¦æ±‚ |
| assessment | string | æ˜¯ | æœŸæœ«è€ƒæ ¸æ–¹å¼ |
| highlights | string | æ˜¯ | è¯¾ç¨‹äº®ç‚¹ |
| suitable_students | string | æ˜¯ | é€‚åˆçš„å­¦ç”Ÿç¾¤ä½“ |
| resources | array | å¦ | æ•™å­¦èµ„æºåˆ—è¡¨ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "course_name": "æ•°æ®ç»“æ„ä¸ç®—æ³•",
  "course_attribute": "ä¸“ä¸šè¯¾ç¨‹",
  "elective_field": "",
  "instructor": "ç‹æ•™æˆ",
  "credit": 3,
  "content": "æœ¬è¯¾ç¨‹ä»‹ç»åŸºæœ¬çš„æ•°æ®ç»“æ„å’Œç®—æ³•è®¾è®¡æ–¹æ³•",
  "attendance": "æ¯å‘¨å®éªŒè¯¾ï¼Œéœ€è¦å®Œæˆå®éªŒæŠ¥å‘Š",
  "assessment": "æœŸæœ«è€ƒè¯•å 50%ï¼Œå®éªŒæˆç»©å 30%ï¼Œå¹³æ—¶ä½œä¸šå 20%",
  "highlights": "ç†è®ºä¸å®è·µç›¸ç»“åˆï¼Œæä¾›å¤§é‡ç¼–ç¨‹ç»ƒä¹ ",
  "suitable_students": "é€‚åˆè®¡ç®—æœºç›¸å…³ä¸“ä¸šçš„å­¦ç”Ÿ",
  "resources": ["æ•™æ", "PPT", "å®éªŒæŒ‡å¯¼ä¹¦", "åœ¨çº¿ç¼–ç¨‹å¹³å°"]
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "è¯¾ç¨‹æ¨å¹¿ä¿¡æ¯æäº¤æˆåŠŸ"
}
```

---

### 7. è·å–æ¨å¹¿è¯¾ç¨‹åˆ—è¡¨

è·å–æ‰€æœ‰æˆ–æœç´¢ç‰¹å®šçš„æ¨å¹¿è¯¾ç¨‹ã€‚

**æ¥å£åœ°å€**: `/course_promotion`

**è¯·æ±‚æ–¹æ³•**: `GET`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| course_name | string | å¦ | è¯¾ç¨‹åç§°ï¼ˆæ¨¡ç³Šæœç´¢ï¼‰ |
| instructor | string | å¦ | æ•™å¸ˆå§“åï¼ˆæ¨¡ç³Šæœç´¢ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /course_promotion?course_name=æ•°æ®ç»“æ„
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "è·å–è¯¾ç¨‹åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "course_name": "æ•°æ®ç»“æ„ä¸ç®—æ³•",
      "course_attribute": "ä¸“ä¸šè¯¾ç¨‹",
      "elective_field": "",
      "instructor": "ç‹æ•™æˆ",
      "credit": "3",
      "content": "æœ¬è¯¾ç¨‹ä»‹ç»åŸºæœ¬çš„æ•°æ®ç»“æ„å’Œç®—æ³•è®¾è®¡æ–¹æ³•",
      "attendance": "æ¯å‘¨å®éªŒè¯¾ï¼Œéœ€è¦å®Œæˆå®éªŒæŠ¥å‘Š",
      "assessment": "æœŸæœ«è€ƒè¯•å 50%ï¼Œå®éªŒæˆç»©å 30%ï¼Œå¹³æ—¶ä½œä¸šå 20%",
      "highlights": "ç†è®ºä¸å®è·µç›¸ç»“åˆ",
      "suitable_students": "é€‚åˆè®¡ç®—æœºç›¸å…³ä¸“ä¸šçš„å­¦ç”Ÿ",
      "resources": ["æ•™æ", "PPT", "å®éªŒæŒ‡å¯¼ä¹¦"]
    }
  ]
}
```

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒï¼ˆéœ€è¦å…ˆæäº¤è¯„ä»·æˆ–é—®å·ï¼‰ |
| 403 | ç¦æ­¢è®¿é—®ï¼ˆè®¾å¤‡æŒ‡çº¹éªŒè¯å¤±è´¥ï¼‰ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ï¼ˆè¶…å‡ºé™åˆ¶ï¼‰ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## å¼€å‘å»ºè®®

### é”™è¯¯å¤„ç†

å»ºè®®åœ¨å‰ç«¯ç»Ÿä¸€å¤„ç† API é”™è¯¯ï¼š

```javascript
async function callApi(url, options) {
  try {
    const response = await axios(url, options);
    return response.data;
  } catch (error) {
    if (error.response) {
      // æœåŠ¡å™¨è¿”å›é”™è¯¯
      console.error('API Error:', error.response.status, error.response.data);
      // æ˜¾ç¤ºé”™è¯¯æç¤º
      showErrorMessage(error.response.data.message);
    } else if (error.request) {
      // è¯·æ±‚å‘é€ä½†æ²¡æœ‰æ”¶åˆ°å“åº”
      console.error('Network Error');
      showErrorMessage('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
    } else {
      // å…¶ä»–é”™è¯¯
      console.error('Error:', error.message);
      showErrorMessage('è¯·æ±‚å¤±è´¥');
    }
    throw error;
  }
}
```

### è¯·æ±‚è¶…æ—¶

å¯¹äºå¯èƒ½è€—æ—¶è¾ƒé•¿çš„è¯·æ±‚ï¼ˆå¦‚ AI æ¨èï¼‰ï¼Œå»ºè®®è®¾ç½®è¾ƒé•¿çš„è¶…æ—¶æ—¶é—´ï¼š

```javascript
axios.post('/rag', data, {
  timeout: 120000  // 120ç§’
});
```

### è¯·æ±‚å–æ¶ˆ

å¯¹äºå¯èƒ½è¢«ç”¨æˆ·ä¸­æ–­çš„è¯·æ±‚ï¼Œå»ºè®®æ”¯æŒå–æ¶ˆï¼š

```javascript
const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios.get('/search', {
  cancelToken: source.token
});

// å–æ¶ˆè¯·æ±‚
source.cancel('ç”¨æˆ·å–æ¶ˆäº†è¯·æ±‚');
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024  
**ç»´æŠ¤è€…**: CopyRight by JeredGong

